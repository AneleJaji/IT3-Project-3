<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="register.css">
    <title>Register</title>
</head>

<body>
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="register.css">
        <title>Register</title>
    </head>

    <body>
        <div class="corner-logo">
            <img src="images/logo.svg" alt="Company Logo">
        </div>

        <div class="form-card">
            <h2 class="form-title">Register</h2>
            <div class="success-message" id="registerSuccess"></div>

            <form id="registerForm">
                <div class="form-group">
                    <label for="firstName">First name</label>
                    <input type="text" id="firstName" name="firstName" required>
                    <div class="error-message" id="firstNameError">Please enter your first name</div>
                </div>

                <div class="form-group">
                    <label for="lastName">Last name</label>
                    <input type="text" id="lastName" name="lastName" required>
                    <div class="error-message" id="lastNameError">Please enter your last name</div>
                </div>

                <div class="form-group">
                    <label for="email">Email address</label>
                    <input type="email" id="email" name="email" required>
                    <div class="error-message" id="emailError">Please enter a valid email address</div>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                    <div class="error-message" id="passwordError">Password must be at least 8 characters long</div>
                </div>


                <button type="submit" class="submit-btn" id="registerBtn">
                    Register
                </button>

                <div class="form-footer">
                    Already have an account? <a href="login.html">Login here</a>
                </div>
            </form>
        </div>
        <script>
            const form = document.getElementById('registerForm');
            const submitBtn = form.querySelector('.submit-btn');

            function showError(fieldId, message) {
                const input = document.getElementById(fieldId);
                const errorDiv = document.getElementById(fieldId + 'Error');

                input.classList.add('error');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }

            function clearErrors() {
                const errors = document.querySelectorAll('.error-message');
                const inputs = document.querySelectorAll('input');

                errors.forEach(error => error.style.display = 'none');
                inputs.forEach(input => input.classList.remove('error'));
            }

            function showSuccess(message) {
                const successDiv = document.getElementById('success');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
            }

            form.addEventListener('submit', async function (e) {
                e.preventDefault();
                clearErrors();

                const formData = new FormData(form);
                const data = {
                    firstName: formData.get('firstName').trim(),
                    lastName: formData.get('lastName').trim(),
                    email: formData.get('email').trim().toLowerCase(),
                    password: formData.get('password')
                };

                // validation
                if (data.firstName.length < 2) {
                    showError('firstName', 'First name must be at least 2 characters');
                    return;
                }
                if (data.lastName.length < 2) {
                    showError('lastName', 'Last name must be at least 2 characters');
                    return;
                }
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
                    showError('email', 'Please enter a valid email address');
                    return;
                }
                if (data.password.length < 8) {
                    showError('password', 'Password must be at least 8 characters');
                    return;
                }

                // Submit form
                submitBtn.textContent = 'Processing...';
                submitBtn.disabled = true;

                try {
                    const response = await fetch('/api/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.message || 'Registration failed');
                    }

                    showSuccess('Registration successful! Redirecting...');
                    form.reset();
                    setTimeout(() => window.location.href = 'login.html', 2000);

                } catch (error) {
                    if (error.message.includes('email already exists')) {
                        showError('email', 'This email is already registered');
                    } else {
                        showError('email', 'Registration failed. Please try again.');
                    }
                } finally {
                    submitBtn.textContent = 'Register';
                    submitBtn.disabled = false;
                }
            });

            // Clear errors 
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', function () {
                    if (this.classList.contains('error')) {
                        this.classList.remove('error');
                        document.getElementById(this.id + 'Error').style.display = 'none';
                    }
                });
            });
        </script>
    </body>

    </html>